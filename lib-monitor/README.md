# lib-monitor

`lib-monitor` — это библиотека Lua, предназначенная для мониторинга DVB-тюнеров и потоков каналов в рамках системы Astra. Она предоставляет набор функций для управления и отслеживания состояния различных компонентов мониторинга.

## Основные возможности:

*   **Мониторинг DVB-тюнеров**: Инициализация, запуск, обновление параметров и получение статуса DVB-тюнеров.
*   **Мониторинг каналов**: Создание, обновление, поиск и удаление мониторов для потоков каналов.
*   **Гибкая конфигурация**: Поддержка различных типов мониторов (входной, выходной, IP) и настраиваемых параметров, таких как погрешность битрейта, интервалы проверки и методы сравнения.
*   **Интеграция с Astra**: Использует глобальные функции Astra для управления каналами и потоками.
*   **Логирование**: Интегрированное логирование для отслеживания операций и ошибок.

## Структура проекта:

*   `adapters/`: Содержит модули, отвечающие за взаимодействие с различными аппаратными и программными адаптерами. Например, `dvb_tuner.lua` для работы с DVB-тюнерами.
*   `channel/`: Включает модули для управления жизненным циклом каналов и их мониторингом. Например, `channel.lua` для основных операций с каналами и `channel_monitor.lua` для логики мониторинга.
*   `config/`: Хранит файлы конфигурации, определяющие параметры работы мониторов, такие как лимиты и интервалы проверки. Например, `monitor_config.lua`.
*   `dispatcher/`: Содержит менеджеры, которые координируют работу различных типов мониторов, регистрируют их и управляют их состоянием. Например, `channel_monitor_manager.lua` и `dvb_monitor_manager.lua`.
*   `http/`: Модули для создания и управления HTTP-сервером, который может использоваться для взаимодействия с системой мониторинга. Например, `http_server.lua`.
*   `utils/`: Вспомогательные утилиты, такие как модуль логирования (`logger.lua`) и другие общие функции (`utils.lua`).

## Использование:

Библиотека предназначена для использования в проектах, требующих детального мониторинга DVB-тюнеров и потоков каналов. Основные функции включают:

*   `dvb_tuner_monitor(conf)`: Инициализация и запуск мониторинга DVB-тюнера.
*   `make_monitor(config, channel_data)`: Создание и регистрация нового монитора канала.
*   `make_stream(conf)`: Создание и запуск потока с мониторингом.
*   `update_monitor_parameters(name, params)`: Обновление параметров существующего монитора канала.
*   `kill_monitor(monitor_obj)`: Остановка и удаление монитора.
*   `kill_stream(channel_data)`: Остановка потока и связанного с ним монитора.

---
**Примечание**: Для полноценной работы библиотека требует наличия глобальных функций Astra, таких как `find_channel`, `make_channel`, `kill_channel`, `get_stream` и `table.copy`, `string.split`, `check`.
